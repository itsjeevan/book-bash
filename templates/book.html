{% extends "layout.html" %}


{% block body %}

<nav class="nav">
    <a class="nav__link nav__link--green" href="{{ url_for('search') }}">Search</a>
    <a class="nav__link nav__link--red" href="{{ url_for('logout') }}">Logout</a>
</nav>

<div class="main-container">

    <h2 class="book-title">{{ book.title }}</h2>

    <div class="book-container">

        <div class="book-details">

            <h3 class="book-section">Book Info</h3>
            <div class="book-box book-info">
                <h4 class="book-category">ISBN</h4>
                <p class="book-category-info">{{ book.isbn }}</p>
                <h4 class="book-category">Author</h4>
                <p class="book-category-info">{{ book.author }}</p>
                <h4 class="book-category">Year</h4>
                <p class="book-category-info">{{ book.year }}</p>
            </div>
            
            <h3 class="book-section">Goodreads</h3>
            <div class="book-box goodreads">
                <h4 class="book-category">Rating</h4>
                <p class="book-category-info">{{ average_rating }} / 5 ({{ review_count }})</p>
            </div>
            
        </div>

        <div class="review">
            
            <h3 class="book-section">Reviews</h3>
            <div class="book-box reviews">

                <form class="review-form" action="{{ url_for('book', isbn=book.isbn) }}" method="post">
                    <select class="review-form-select{% if invalid_feedback %} is-invalid{% endif %}" name="rating">
                        <option selected disabled>Select a rating...</option>
                        <option class="option"  value="1">★☆☆☆☆</option>
                        <option class="option"  value="2">★★☆☆☆</option>
                        <option class="option"  value="3">★★★☆☆</option>
                        <option class="option"  value="4">★★★★☆</option>
                        <option class="option"  value="5">★★★★★</option>
                    </select>
                    <textarea class="review-form-text{% if invalid_feedback %} is-invalid{% endif %}"  name="review" placeholder="Your Review"></textarea>
                    <button class="button button--blue review-form-button" type="submit">Post</button>
                </form>
                
                {% if reviewed %}
                <p>{{ reviewed }}</p>
                {% elif invalid_feedback %}
                <p>{{ invalid_feedback }}</p>
                {% endif %}
                
                {% if results %}
                <ul class="reviews-list">
                    {% for review in reviews %}
                    <li class="reviews-list-item">
                        <p class="stars">{% for i in range(review.rating) %}★{% endfor %}{% for i in range(5 - review.rating) %}☆{% endfor %}</p>
                        <p class="reviews-list-review">{{ review.review }}</p>
                        <p class="username">{{ review.user_username }}</p>
                    </li>
                    {% endfor %}
                </ul>
                {% else %}
                <p>No reviews found</p>
                {% endif %}
            </div>
            
        </div>

    </div>
        
</div>

{% endblock %}